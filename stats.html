<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <title>Statystyka ankiety / –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ä–æ—Å–∞</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body { background: #f5f7fa; font-family: sans-serif; margin: 0; padding: 0;}
    .container { max-width: 900px; margin: 35px auto; background: #fff; border-radius: 18px; box-shadow: 0 8px 28px rgba(34, 100, 34, 0.11); padding: 24px 18px 14px; }
    h1 { text-align: center; margin-bottom: 8px;}
    .lang-switch { text-align: right; margin-bottom: 18px;}
    .lang-switch button { border: none; background: #2e7d32; color: #fff; border-radius: 8px; padding: 7px 14px; margin-left: 6px; cursor: pointer;}
    .qstat { margin: 38px 0 44px;}
    .qtitle { font-weight: bold; font-size: 1.08em; margin-bottom: 7px;}
    .answers-list { margin: 8px 0 6px 8px; }
    .answers-list span { display: inline-block; min-width: 130px; }
    .count-bar { display: inline-block; vertical-align: middle; height: 11px; border-radius: 4px; margin-right: 8px;}
    canvas { margin: 10px auto 0; display: block;}
    @media (max-width: 900px) { .container { padding: 8px 2vw;} }
    @media (max-width: 540px) { .answers-list span { min-width: 90px; } }
  </style>
</head>
<body>
  <div class="container">
    <div class="lang-switch">
      <button onclick="setLang('pl')">üáµüá± Polski</button>
      <button onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
    </div>
    <h1 id="statTitle">Statystyka ankiety</h1>
    <div id="resultsBlock">
      <div style="text-align:center; color:#888; font-size:1.04em; margin: 55px 0 0;">
        ≈Åadowanie wynik√≥w... / –ó–∞–≥—Ä—É–∑–∫–∞...
      </div>
    </div>
    <div style="margin:36px 0 4px; text-align:center; color:#aaa; font-size:0.96em;">
      NSZZ ‚ÄûSolidarno≈õƒá‚Äù w Autodoc
    </div>
  </div>
<script>
const QUESTIONS = [
  {
    pl: "1. Jak oceniasz styl zarzƒÖdzania obecnego kierownika magazynu?",
    ru: "1. –ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ —Å—Ç–∏–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è —Å–∫–ª–∞–¥–∞?",
    options: [
      {pl: "SzanujƒÖcy i profesjonalny", ru: "–£–≤–∞–∂–∏—Ç–µ–ª—å–Ω—ã–π –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π"},
      {pl: "Ch≈Çodny i formalny", ru: "–•–æ–ª–æ–¥–Ω—ã–π –∏ —Ñ–æ—Ä–º–∞–ª—å–Ω—ã–π"},
      {pl: "Autorytarny, powodujƒÖcy napiƒôcie", ru: "–ê–≤—Ç–æ—Ä–∏—Ç–∞—Ä–Ω—ã–π, –≤—ã–∑—ã–≤–∞—é—â–∏–π –Ω–∞–ø—Ä—è–∂–µ–Ω–∏–µ"},
      {pl: "Poni≈ºajƒÖcy i wzbudzajƒÖcy strach", ru: "–£–Ω–∏–∂–∞—é—â–∏–π –∏ —Å–æ–∑–¥–∞—é—â–∏–π —Å—Ç—Ä–∞—Ö"}
    ]
  },
  {
    pl: "2. Jak siƒô czujesz w kontakcie z kierownikiem magazynu?",
    ru: "2. –ö–∞–∫ –≤—ã —Å–µ–±—è —á—É–≤—Å—Ç–≤—É–µ—Ç–µ –ø—Ä–∏ –æ–±—â–µ–Ω–∏–∏ —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º —Å–∫–ª–∞–¥–∞?",
    options: [
      {pl: "Pewnie", ru: "–£–≤–µ—Ä–µ–Ω–Ω–æ"},
      {pl: "Z napiƒôciem", ru: "–ù–∞–ø—Ä—è–∂—ë–Ω–Ω–æ"},
      {pl: "Unikam kontaktu", ru: "–ò–∑–±–µ–≥–∞—é –æ–±—â–µ–Ω–∏—è"},
      {pl: "Odczuwam strach i bezsilno≈õƒá", ru: "–ß—É–≤—Å—Ç–≤—É—é —Å—Ç—Ä–∞—Ö –∏ –Ω–µ–∑–∞—â–∏—â—ë–Ω–Ω–æ—Å—Ç—å"}
    ]
  },
  {
    pl: "3. Jak czƒôsto masz realny dostƒôp do rozmowy z kierownikiem magazynu w sprawach s≈Çu≈ºbowych?",
    ru: "3. –ù–∞—Å–∫–æ–ª—å–∫–æ —á–∞—Å—Ç–æ –≤—ã –∏–º–µ–µ—Ç–µ —Ä–µ–∞–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –æ–±—â–µ–Ω–∏—é —Å —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª–µ–º —Å–∫–ª–∞–¥–∞ –ø–æ —Ä–∞–±–æ—á–∏–º –≤–æ–ø—Ä–æ—Å–∞–º?",
    options: [
      {pl: "Kierownik zawsze jest dostƒôpny", ru: "–†—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—å –≤—Å–µ–≥–¥–∞ –¥–æ—Å—Ç—É–ø–µ–Ω"},
      {pl: "Czasami udaje siƒô porozmawiaƒá", ru: "–ò–Ω–æ–≥–¥–∞ —É–¥–∞—ë—Ç—Å—è –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å"},
      {pl: "Prawie zawsze odmawia kontaktu", ru: "–ü–æ—á—Ç–∏ –≤—Å–µ–≥–¥–∞ –æ—Ç–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –æ—Ç –æ–±—â–µ–Ω–∏—è"},
      {pl: "Ca≈Çkowicie unika kontaktu z pracownikami", ru: "–°–æ–≤—Å–µ–º –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω, –∏–∑–±–µ–≥–∞–µ—Ç —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–≤"}
    ]
  },
  {
    pl: "4. Jak zmieni≈Çy siƒô Twoje warunki pracy i samopoczucie po objƒôciu funkcji przez obecnego kierownika?",
    ru: "4. –ö–∞–∫ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å –º–æ—Ä–∞–ª—å–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∏ —É—Å–ª–æ–≤–∏—è —Ç—Ä—É–¥–∞ –ø–æ—Å–ª–µ –ø—Ä–∏—Ö–æ–¥–∞ —Ç–µ–∫—É—â–µ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è?",
    options: [
      {pl: "Poprawi≈Çy siƒô", ru: "–£–ª—É—á—à–∏–ª–∏—Å—å"},
      {pl: "Bez zmian", ru: "–ù–µ –∏–∑–º–µ–Ω–∏–ª–∏—Å—å"},
      {pl: "Pogorszy≈Çy siƒô", ru: "–£—Ö—É–¥—à–∏–ª–∏—Å—å"},
      {pl: "Sta≈Çy siƒô nie do zniesienia", ru: "–°—Ç–∞–ª–∏ –Ω–µ–≤—ã–Ω–æ—Å–∏–º—ã–º–∏"}
    ]
  },
  {
    pl: "5. Jak zachowanie kierownictwa wp≈Çynƒô≈Ço na produktywno≈õƒá pracy w zespole?",
    ru: "5. –ö–∞–∫, –ø–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é, –ø–æ–≤–µ–¥–µ–Ω–∏–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–∞ –ø–æ–≤–ª–∏—è–ª–æ –Ω–∞ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Ç—Ä—É–¥–∞ –≤ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–µ?",
    options: [
      {pl: "Wydajno≈õƒá wzros≈Ça", ru: "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –≤—ã—Ä–æ—Å–ª–∞"},
      {pl: "Bez zmian", ru: "–ù–µ –∏–∑–º–µ–Ω–∏–ª–∞—Å—å"},
      {pl: "Nieco spad≈Ça", ru: "–°–Ω–∏–∑–∏–ª–∞—Å—å –Ω–µ–º–Ω–æ–≥–æ"},
      {pl: "Znacznie siƒô pogorszy≈Ça", ru: "–°–∏–ª—å–Ω–æ —É–ø–∞–ª–∞ –∏–∑-–∑–∞ –∞—Ç–º–æ—Å—Ñ–µ—Ä—ã"}
    ]
  },
  {
    pl: "6. Jak oceniasz zmiany w podej≈õciu do kar dyscyplinarnych po objƒôciu funkcji przez obecnego kierownika?",
    ru: "6. –ö–∞–∫ –≤—ã –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ –∫ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞—Ä–Ω—ã–º –≤–∑—ã—Å–∫–∞–Ω–∏—è–º –ø–æ—Å–ª–µ –ø—Ä–∏—Ö–æ–¥–∞ –Ω–æ–≤–æ–≥–æ —Ä—É–∫–æ–≤–æ–¥–∏—Ç–µ–ª—è —Å–∫–ª–∞–¥–∞?",
    options: [
      {pl: "Nie zauwa≈ºy≈Çem/am r√≥≈ºnicy", ru: "–ù–µ –∑–∞–º–µ—Ç–∏–ª(–∞) —Ä–∞–∑–Ω–∏—Ü—ã"},
      {pl: "SƒÖ one nak≈Çadane czƒô≈õciej ni≈º wcze≈õniej", ru: "–ò—Ö —Å—Ç–∞–ª–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —á–∞—â–µ"},
      {pl: "Wzros≈Ça surowo≈õƒá i liczba kar", ru: "–£–∂–µ—Å—Ç–æ—á–∏–ª–∏—Å—å –∏ —É—á–∞—Å—Ç–∏–ª–∏—Å—å –≤–∑—ã—Å–∫–∞–Ω–∏—è"},
      {pl: "Kary sta≈Çy siƒô narzƒôdziem nacisku", ru: "–í–∑—ã—Å–∫–∞–Ω–∏—è –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∫–∞–∫ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–∞–≤–ª–µ–Ω–∏—è"}
    ]
  },
  {
    pl: "7. Czy Twoim zdaniem zdarza≈Çy siƒô niesprawiedliwe lub bezpodstawne kary wobec pracownik√≥w?",
    ru: "7. –ü–æ –≤–∞—à–µ–º—É –º–Ω–µ–Ω–∏—é, —Å–ª—É—á–∞–ª–∏—Å—å –ª–∏ —Å–ª—É—á–∞–∏ –Ω–µ—Å–ø—Ä–∞–≤–µ–¥–ª–∏–≤—ã—Ö –∏–ª–∏ –±–µ–∑–æ—Å–Ω–æ–≤–∞—Ç–µ–ª—å–Ω—ã—Ö –≤–∑—ã—Å–∫–∞–Ω–∏–π –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏–∏ —Ä–∞–±–æ—Ç–Ω–∏–∫–æ–≤?",
    options: [
      {pl: "Tak, wielokrotnie", ru: "–î–∞, –Ω–µ–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ"},
      {pl: "Tak, sporadycznie", ru: "–î–∞, —ç–ø–∏–∑–æ–¥–∏—á–µ—Å–∫–∏"},
      {pl: "Nie, nie zauwa≈ºy≈Çem/am takich przypadk√≥w", ru: "–ù–µ—Ç, –Ω–µ –∑–∞–º–µ—á–∞–ª(–∞)"},
      {pl: "Trudno powiedzieƒá", ru: "–¢—Ä—É–¥–Ω–æ —Å–∫–∞–∑–∞—Ç—å"}
    ]
  }
];

let curLang = localStorage.getItem("ankieta_lang") || "pl";
let results = [];

function setLang(lang) {
  curLang = lang;
  localStorage.setItem("ankieta_lang", lang);
  document.getElementById("statTitle").textContent = (lang === "pl" ? "Statystyka ankiety" : "–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ–ø—Ä–æ—Å–∞");
  renderAll();
}

setLang(curLang);

async function loadResults() {
  try {
    const resp = await fetch("/results");
    if (resp.ok) {
      results = await resp.json();
      renderAll();
    } else {
      showErr("B≈ÇƒÖd pobierania danych / –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö");
    }
  } catch {
    showErr("Brak po≈ÇƒÖczenia z serwerem / –ù–µ—Ç —Å–≤—è–∑–∏ —Å —Å–µ—Ä–≤–µ—Ä–æ–º");
  }
}

function showErr(msg) {
  document.getElementById("resultsBlock").innerHTML = `<div style="color:#d00; text-align:center; margin:60px 0 20px;">${msg}</div>`;
}

function renderAll() {
  if (!results.length) {
    document.getElementById("resultsBlock").innerHTML = `<div style="text-align:center; color:#888; font-size:1.04em; margin: 55px 0 0;">Brak odpowiedzi / –ù–µ—Ç –æ—Ç–≤–µ—Ç–æ–≤</div>`;
    return;
  }
  let html = '';
  QUESTIONS.forEach((q, qi) => {
    let counts = [0, 0, 0, 0],
      total = 0;
    results.forEach(ans => {
      let idx = Number(ans['q' + (qi + 1)]) - 1;
      if (idx >= 0 && idx < 4) {
        counts[idx]++;
        total++;
      }
    });
    html += `<div class="qstat"><div class="qtitle">${q[curLang]}</div><div class="answers-list">`;
    q.options.forEach((op, i) => {
      let c = counts[i],
        p = total ? Math.round(1000 * c / total) / 10 : 0;
      html += `<div>
        <span>${op[curLang]}</span>
        <span style="font-weight:600; margin-left:8px;">${c}</span>
        <span style="color:#888; margin-left:5px;">(${p}%)</span>
      </div>`;
    });
    html += `</div><canvas id="chart_q${qi + 1}" width="390" height="170"></canvas></div>`;
  });
  document.getElementById("resultsBlock").innerHTML = html;
  setTimeout(drawCharts, 50);
}

function drawCharts() {
  QUESTIONS.forEach((q, qi) => {
    let ctx = document.getElementById('chart_q' + (qi + 1));
    if (!ctx) return;
    let counts = [0, 0, 0, 0],
      total = 0;
    results.forEach(ans => {
      let idx = Number(ans['q' + (qi + 1)]) - 1;
      if (idx >= 0 && idx < 4) {
        counts[idx]++;
        total++;
      }
    });
    if (ctx.chart) {
      ctx.chart.destroy();
    }
    ctx.chart = new Chart(ctx, {
      type: "pie",
      data: {
        labels: q.options.map(op => op[curLang]),
        datasets: [{
          data: counts,
          borderWidth: 1
        }]
      },
      options: {
        plugins: {
          legend: {
            position: "bottom"
          },
          tooltip: {
            callbacks: {
              label: c => c.label + ": " + c.raw + " (" + (total ? Math.round(1000 * c.raw / total) / 10 : 0) + "%)"
            }
          }
        }
      }
    });
  });
}

loadResults();
</script>
</body>
</html>
