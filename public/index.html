<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="utf-8"/>
<title>Ankieta anonimowa / –ê–Ω–æ–Ω–∏–º–Ω—ã–π –æ–ø—Ä–æ—Å</title>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<style>
    body { font-family: sans-serif; text-align: center; margin: 30px; background-color: #f5f7fa; }
    #intro, #geoStage { display: none; }
    #intro.active, #geoStage.active { display: block; }
    #message { font-size: 1.2em; margin-top: 30px; }
    iframe { margin-top: 40px; width: 100%; height: 1200px; border: none; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .btn { margin: 20px 10px; padding: 12px 24px; font-size: 1em; border: none; border-radius: 8px; cursor: pointer; transition: background-color 0.3s ease, transform 0.2s ease; }
    #continueButton { background: linear-gradient(135deg, #2e7d32, #43a047); color: white; font-size: 1.1em; padding: 14px 30px; margin-top: 30px; box-shadow: 0 4px 10px rgba(34, 139, 34, 0.3); }
    #startButton { background-color: #4CAF50; color: white; }
    #startButton:hover { background-color: #45a049; transform: scale(1.05); }
    #retryButton { background-color: #2196F3; color: white; }
    #retryButton:hover { background-color: #1976D2; transform: scale(1.05); }
    #poster { max-width: 100%; max-height: 800px; margin-bottom: 30px; box-shadow: 0 0 8px rgba(0,0,0,0.15); }
</style>
</head>
<body>
<div class="active" id="intro">
  <h1>Witamy! / –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!</h1>
  <p>Przeczytaj instrukcjƒô poni≈ºej, zanim rozpoczniesz.<br/>–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é –ø–µ—Ä–µ–¥ –Ω–∞—á–∞–ª–æ–º.</p>
  <img alt="Instrukcja / –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è" id="poster" src="14.07.2025.png"/>
  <button class="btn" id="continueButton" onclick="goToInfoTabs()">‚û°Ô∏è Kontynuuj / –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
</div>
<div id="geoStage">
  <h1>Sprawdzenie lokalizacji / –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏—è</h1>
  <div id="message">Kliknij poni≈ºszy przycisk, aby rozpoczƒÖƒá. / –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞.</div>
  <button class="btn" id="startButton">üìç Sprawd≈∫ lokalizacjƒô / –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ</button>
  <button class="btn" id="retryButton" style="display:none;">üîÑ Od≈õwie≈º / –û–±–Ω–æ–≤–∏—Ç—å</button>
  <button class="btn" id="backToIntroButton" style="display:none; background-color: #2e7d32; color: white; margin-left: 10px;">üîô Wr√≥ƒá / –í–µ—Ä–Ω—É—Ç—å—Å—è –≤ –Ω–∞—á–∞–ª–æ</button>
</div>
<script>
function goToInfoTabs() {
  document.getElementById('intro').classList.remove('active');
  document.getElementById('geoStage').classList.add('active');
}
document.addEventListener("DOMContentLoaded", function() {
  const warehouseLat = 53.411942;
  const warehouseLon = 14.712341;
  const allowedRadius = 100;
  const intro = document.getElementById('intro');
  const geoStage = document.getElementById('geoStage');
  const startButton = document.getElementById('startButton');
  const retryButton = document.getElementById('retryButton');
  const message = document.getElementById('message');
  const backToIntroButton = document.getElementById('backToIntroButton');

  // –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∞–Ω–∫–µ—Ç—ã –µ—Å–ª–∏ localStorage —É–∂–µ –µ—Å—Ç—å
  if (localStorage.getItem("ankieta_wypelniona") === "true") {
    intro.classList.remove('active');
    geoStage.classList.add('active');
    message.innerHTML = "‚úÖ Ju≈º wype≈Çni≈Çe≈õ(-a≈õ) tƒô ankietƒô. / –í—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å.";
    startButton.style.display = 'none';
    retryButton.style.display = 'none';
    backToIntroButton.style.display = 'inline-block';
  }

  startButton.addEventListener('click', () => {
    runGeolocationCheck();
  });

  retryButton.addEventListener('click', () => {
    backToIntroButton.style.display = 'none';
    resetToInitialState();
  });

  function runGeolocationCheck() {
    message.textContent = '‚è≥ Sprawdzanie wsp√≥≈Çrzƒôdnych... / –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç...';
    startButton.style.display = 'none';
    retryButton.style.display = 'none';

    navigator.geolocation.getCurrentPosition(success, error, {
      enableHighAccuracy: true,
      timeout: 10000,
      maximumAge: 0
    });
  }

  function success(position) {
    const userLat = position.coords.latitude;
    const userLon = position.coords.longitude;
    const distance = getDistanceFromLatLonInMeters(userLat, userLon, warehouseLat, warehouseLon);

    if (distance <= allowedRadius) {
      if (!localStorage.getItem("ankieta_wypelniona")) {
        localStorage.setItem("ankieta_wypelniona", "true");
        message.innerHTML = `
          ‚úÖ Lokalizacja potwierdzona. Wype≈Çnij formularz poni≈ºej:<br>
          ‚úÖ –ú–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–æ. –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –Ω–∏–∂–µ:
          <iframe src="/form" style="width:100%; height:1200px; border:none; box-shadow: 0 0 10px rgba(0,0,0,0.1);">
            ≈Åadowanie formularza‚Ä¶ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ä–º—ã‚Ä¶
          </iframe>
        `;
      } else {
        message.innerHTML = "‚úÖ Ju≈º wype≈Çni≈Çe≈õ(-a≈õ) tƒô ankietƒô. / –í—ã —É–∂–µ –ø—Ä–æ—à–ª–∏ —ç—Ç–æ—Ç –æ–ø—Ä–æ—Å.";
      }
      retryButton.style.display = 'inline-block';
      backToIntroButton.style.display = 'inline-block';
      startButton.style.display = 'none';
    } else {
      message.textContent = '‚ùå Ankieta dostƒôpna tylko na terenie magazynu AutoDoc M13. / –û–ø—Ä–æ—Å –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–æ–ª—å–∫–æ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ —Å–∫–ª–∞–¥–∞ AutoDoc –ú13.';
      retryButton.style.display = 'inline-block';
      backToIntroButton.style.display = 'inline-block';
      startButton.style.display = 'none';
    }
  }

  function error(err) {
    console.warn(`B≈ÇƒÖd geolokalizacji: ${err.message}`);
    message.textContent = '‚ö†Ô∏è Nie uda≈Ço siƒô uzyskaƒá wsp√≥≈Çrzƒôdnych. Zezw√≥l na dostƒôp do lokalizacji i spr√≥buj ponownie. / –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã. –†–∞–∑—Ä–µ—à–∏—Ç–µ –¥–æ—Å—Ç—É–ø –∫ –≥–µ–æ–ª–æ–∫–∞—Ü–∏–∏ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.';
    retryButton.style.display = 'inline-block';
    backToIntroButton.style.display = 'inline-block';
    startButton.style.display = 'none';
  }

  function resetToInitialState() {
    message.textContent = 'Kliknij poni≈ºszy przycisk, aby rozpoczƒÖƒá. / –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞.';
    startButton.style.display = 'inline-block';
    retryButton.style.display = 'none';
  }

  function getDistanceFromLatLonInMeters(lat1, lon1, lat2, lon2) {
    const R = 6371000;
    const dLat = deg2rad(lat2 - lat1);
    const dLon = deg2rad(lon2 - lon1);
    const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
              Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
              Math.sin(dLon / 2) * Math.sin(dLon / 2);
    const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    return R * c;
  }

  function deg2rad(deg) {
    return deg * (Math.PI / 180);
  }

  backToIntroButton.addEventListener('click', () => {
    geoStage.classList.remove('active');
    intro.classList.add('active');
    startButton.style.display = 'inline-block';
    retryButton.style.display = 'none';
    backToIntroButton.style.display = 'none';
    message.textContent = 'Kliknij poni≈ºszy przycisk, aby rozpoczƒÖƒá. / –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ –¥–ª—è –Ω–∞—á–∞–ª–∞.';
  });
});
</script>
</body>
</html>
